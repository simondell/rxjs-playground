<!DOCTYPE html>
<html>
<head>
	<title>my first rx page</title>

	<style>
	ol, li, input, button {
		padding: 0;
		margin: 0;
	}

	[role="application"] ol {
		overflow: scroll;
		width: 298px;
		height: 298px;
		border: 1px solid grey;
	}

	[role="application"] form {
		width: 292px;
		padding: 4px;
		background-color: grey;
 	}

	[role="application"] input,
	[role="application"] button {
		height: 2em;
		line-height: 2;
		border: 0;
		vertical-align: middle;
	}
	
	[role="application"] input {
		width: 230px;
		padding: 0 4px;
		margin-right: 4px; 
	}

	[role="application"] button {
		width: 50px;
		background-color: white;
	}
	</style>


</head>

<body>
	<main role="application">
		<h1>An RX playground</h1>
		<ol></ol>
		<form action="index.html" name="send-messages">
			<input type="text" name="msg"><button name="send">Send</button>
		</form>
	</main>

	<script src="/socket.io/socket.io.js"></script>
	<script>
		var socket = io();
		var msg_form = document.querySelector( '[name="send-messages"]' );
		var new_msg = msg_form.querySelector( 'input' ); 
		var messages_display = document.querySelector( '[role="application"] ol' );

		// sending
		function handleMessageSubmit ( event ) {
			socket.emit('chat message', this.value );
    	this.value = '';
			event.preventDefault();
			return false;
		};

		msg_form.addEventListener( 'submit', handleMessageSubmit.bind( new_msg ) );


		// receiving
		function handleMessageRecieved ( msg ) {
			var old_content = this.innerHTML;
			var new_content = '<li>' + msg + '</li>';
			this.innerHTML = old_content + new_content;
		};

		socket.on('chat message', handleMessageRecieved.bind( messages_display ) );		
	</script>
</body>

</html>